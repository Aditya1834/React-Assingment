import React, { useState, useEffect } from 'react';
import RestaurantList from './components/RestaurantList';
import AddRestaurantForm from './components/AddRestaurantForm';
import EditRestaurantForm from './components/EditRestaurantForm';

function App() {
  const [restaurants, setRestaurants] = useState([]);
  const [showAddForm, setShowAddForm] = useState(false);
  const [showEditForm, setShowEditForm] = useState(false);
  const [selectedRestaurant, setSelectedRestaurant] = useState({});

  useEffect(() => {
    fetchRestaurants();
  }, []);

  const fetchRestaurants = () => {
    fetch('data/restaurants.json')
     .then(response => response.json())
     .then(data => setRestaurants(data));
  };

  const handleAddRestaurant = (newRestaurant) => {
    setRestaurants([...restaurants, newRestaurant]);
    setShowAddForm(false);
  };

  const handleEditRestaurant = (updatedRestaurant) => {
    const updatedRestaurants = restaurants.map((restaurant) => {
      if (restaurant.id === updatedRestaurant.id) {
        return updatedRestaurant;
      }
      return restaurant;
    });
    setRestaurants(updatedRestaurants);
    setShowEditForm(false);
  };

  const handleDeleteRestaurant = (id) => {
    const confirmed = window.confirm('Are you sure you want to delete this restaurant?');
    if (confirmed) {
      const updatedRestaurants = restaurants.filter((restaurant) => restaurant.id!== id);
      setRestaurants(updatedRestaurants);
    }
  };

  return (
    <div>
      <h1>Restaurant List</h1>
      <button onClick={() => setShowAddForm(true)}>Add New Restaurant</button>
      {showAddForm && <AddRestaurantForm onAdd={handleAddRestaurant} />}
      <RestaurantList
        restaurants={restaurants}
        onEdit={(restaurant) => {
          setSelectedRestaurant(restaurant);
          setShowEditForm(true);
        }}
        onDelete={handleDeleteRestaurant}
      />
      {showEditForm && <EditRestaurantForm restaurant={selectedRestaurant} onEdit={handleEditRestaurant}
